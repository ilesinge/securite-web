<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Sécurité Web</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/ir-black.css">

    <!-- Custom CSS for this presentation -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        
        <section>
          <h1>Sécurité Web</h1>
          <img src="img/cool.png" alt="Génial ! Je vais devenir un hacker !" class="fragment roll-in" />
          <p>
            <small>Par Alexandre Gravel-Raymond</small>
          </p>
        </section>
        
        <section id="pourquoi">
          <h2>Pourquoi ?</h2>
          <ul>
            <li>
              Sécurité des utilisateurs
            </li>
            <li>
              Confidentialité des données
            </li>
            <li>
              Intégrité des données
            </li>
            <li>
              Image de l'organisation
            </li>
          </ul>
        </section>
        
        <section>
          <section id="owasp">
            <h2>OWASP</h2>
            <p>
              <a href="https://www.owasp.org/">Open Web Application Security Project</a> est une organisation à but non lucratif fournissant des recommandations, outils et articles de référence sur la sécurité des applications web.
            </p>
          </section>
                  
          <section id="owasp_t10">
            <h2>Projet Top 10</h2>
            <p>
              Liste les 10 risques de sécurité web les plus critiques
            </p>
            <p>
              Dernière version publiée en 2013 et toujours d'actualité
            </p>
          </section>  
        </section>

        <!-- Example of nested vertical slides -->
        <section>
          <section id="injection">
            <h2>1. Injection</h2>
            <div class="fragment roll-in">
              <img class="image" src="img/injection.png" /><br/>
              <small>Source: <a href="http://xkcd.com/327/">xkcd</a></small>
            </div>
          </section>
          
          <section>
            <h2>Injection SQL</h2>
            <p>Cas typique :</p>
              <pre>Code :<code class="php">$sql = "SELECT * FROM users
                 WHERE login = '".$_GET['login']."'
                 AND password = '".$_GET['password']."'";
$user = mysqli_query($sql);</code></pre>
              <pre>Requête :<code class="http">GET /login.php?login=unicorn&password='+OR+'1'='1 HTTP/1.1</code></pre>
              <pre>Résultat :<code class="sql">SELECT * FROM users
         WHERE login = 'unicorn'
         AND password = '' OR '1'='1'</code></pre>
          </section>
                    
          <section>
            <h2>Comment se protéger ?</h2>
            <ol>
              <li>
                Ne jamais faire confiance aux données provenant d'une source tiers (paramètres GET/POST, cookies, base de données, etc).
              </li>
              <li>
                <em><strong>Toujours</strong></em> échapper les chaînes de caractères à insérer dans une requête ou une commande. Exemples :
                <ul>
                  <li><pre>MySQLi :<code class="php">$login = mysqli_real_escape_string($_GET['login']);</code></pre></li>
                  <li><pre>PDO :<code class="php">$login = $connection-&gt;quote($_GET['login']);</code></pre></li>
                </ul>
              </li>
              
            </ol>
          </section>
          
          <section>
            <ol start="3">
              <li>
                Utiliser des requêtes préparées
              </li>
              <li>
                Ne pas réinventer la roue :
              </li>
            </ol>
            <pre><code class="php">// DON'T DO THIS
$login = str_replace("'", "\\'", $_GET['login']);</code></pre>
          </section>
                    
          <section>
            <h2>Attention !</h2>
            
            <p>Des injections sont possibles à chaque moment où l'application utilise des données fournies par le client pour interagir avec un système tiers</p>
            
            <ul>
              <li>Commandes de l'OS (exec(), system(), etc.)</li>
              <li>Envoi de mails (injection d'entêtes)</li>
              <li>Appel à un webservice</li>
              <li>Etc.</li>
            </ul>
            
            <p>
              Le nettoyage de l'input doit être approprié au contexte
            </p>
          </section>
        </section>

        <section>
          <section id="identite">
            <h2>2. Violation de gestion d’authentification et de session</h2>
            <p><img src="img/password.jpg" class="fragment roll-in"/></p>
          </section>
          <section>
            <h2>Exemples</h2>
            <ul>
              <li>Les mots de passe sont stockés ou envoyés en clair (le hachage MD5 est insuffisant, utiliser la fonction password_hash())</li>
              <li>Les sessions durent trop longtemps ou éternellement (prendre en compte les utilisations sur des postes publics)</li>
              <li>Exposition ou vulnérabilité des IDs de session (ex: paramètre PHPSESSID dans l'URL)</li>
            </ul>
          </section>
        </section>

        <section>
          <section id="xss">
            <h2>3. Cross-Site Scripting (XSS)</h2>
            <p><img src="img/xss.png" class="fragment roll-in"/></p>
          </section>
          
          <section>
            <h2>Exemple de faille XSS</h2>
            <pre>Code :<code class="html"><form action="index.php">
  <input type="text" name="q" value="<?php echo $_GET['q']; ?>" />
</form></code></pre>
            <pre>Requête :<code class="http">GET /index.php?q=&quot;/&gt;&lt;script&gt;alert('Vive+le+Québec+Libre+!');&lt;/script&gt; HTTP/1.1</code></pre>
            <pre>Rendu :<code class="html"><form action="search.php">
  <input type="text" name="q" value="&quot;/&gt;&lt;script&gt;alert('Vive le Québec Libre !');&lt;/script&gt;" />
</form></code></pre>

            <div class="fragment" id="quebec"></div>
          </section>
          
          <section>
            <h2>Types</h2>
            <ul>
              <li>
                Serveur / Client
              </li>
              <li>
                Réfléchi / Stocké
              </li>
            </ul>
          </section>
          <section>
            <h2>Risques</h2>
            <ul>
              <li>
                Vol de session
              </li>
              <li>
                Defacement
              </li>
              <li>
                Propagation de virus
              </li>
              <li>
                ...
              </li>
              <li>
                samy is my hero!
              </li>
            </ul>
          </section>
          
          <section>
            <h2>Comment s'en prémunir</h2>
            <ol>
              <li>
                Ne jamais faire confiance aux données provenant d'une source tiers (paramètres GET/POST, cookies, <u>base de données</u>, etc).
              </li>
              <li>
                <em><strong>Toujours</strong></em> échapper les chaînes de caractères à insérer dans dans une page HTML.
                <pre><code class="html"><input value="<?php echo htmlentities($_GET['q']); ?>"/></code></pre>
                Utiliser les méthodes d'échappement fournies par le moteur de template utilisé.
              </li>
            </ol>
          </section>
          
          <section>
            <ol start="3">
              <li>Ne pas réinventer la roue : <pre><code class="php">// DON'T DO THIS
    $q = str_replace('"', '\\"', $_GET['q']);</code></pre></li>
              <li>Toujours déclarer l'encodage de la page HTML pour éviter des contournement par modification de l'encodage (UTF-7)</li>
              <li>
                Utiliser le flag HTTPOnly sur les cookies de session (évitant qu'ils soient récupérés en JavaScript)
              </li>
              <li>
                Envisager l'utilisation de Content Security Policy (CSP) permettant notamment de limiter l'origine d'exécution de scripts JS.
              </li>
            </ol>
          </section>
          
          <section>
            <h2>Attention !</h2>
            
            <p>Il faut toujours prendre en compte le contexte dans lequel la chaîne sera affichée.</p>
            <ul>
              <li>Dans du code JavaScript / JSON : <code>json_encode()</code></li>
              <li>Dans du code CSS</li>
              <li>Dans un URL : <code>url_encode()</code></li>
              <li>Dans un commentaire HTML</li>
            </ul>
          </section>
        </section>

        <section>
          <section id="references">
            <h2>4. Références directes non sécurisées à un objet</h2>
            <p><img src="img/data.png" class="fragment roll-in"/></p>
          </section>
          
          <section>
            <h2>Exemple d'attaque</h2>
            <pre>URL de téléchargement :<code class="url">http://www.example.net/download_file.php?id=665</code></pre>
            
            <p>Intuitivement, on incrémente !</p>
          </section>
          
          <section>
            <h2>Solutions</h2>
            <ol>
              <li>Implémenter des références indirecte aux objets auxquels l'utilisateur a réellement accès.
                <pre>Télécharger <u>mon</u> 6e fichier :<code class="url">http://www.example.net/download_file.php?n=6</code></pre>
              </li>
              <li>
                Vérifier les droits à <strong>chaque</strong> tentative d'accès à une ressource protégée.
              </li>
            </ol>
          </section>
        </section>

        <section id="configuration">
          <h2>5. Mauvaise configuration sécurité</h2>
          <p><img src="img/display_errors.jpg" class="fragment roll-in"/></p>
        </section>
                
        <section>
          <section id="exposition">
            <h2>6. Exposition de données sensibles</h2>
            <blockquote>« Beaucoup d'applications web ne protègent pas correctement les données sensibles telles que les cartes de crédit, identifiants d'impôt et informations d'authentification. Les pirates peuvent voler ou modifier ces données faiblement protégées pour effectuer un vol d'identité, de la fraude à la carte de crédit ou autres crimes. »</blockquote>
            <p><img src="img/sensitive.png" class="fragment roll-in"/></p>
          </section>
          
          <section>
            <h2>Défenses possible</h2>
            <ol>
              <li>Chiffrer les données sensibles (avec un algorithme approprié) lors du <strong>stockage</strong> et du <strong>transport</strong> (SSL) des données</li>
              <li>Stocker le moins possible de données sensibles</li>
            </ol>
          </section>
        </section>
        
        <section id="controle">
          <h2>7. Manque de contrôle d’accès au niveau fonctionnel</h2>
          <blockquote>« Pratiquement toutes les applications web vérifient les droits d'accès au niveau fonctionnel avant de rendre cette fonctionnalité visible dans l'interface utilisateur. Cependant, les applications doivent effectuer les mêmes vérifications de contrôle d'accès sur le serveur lors de l'accès à chaque fonction. »</blockquote>
          <p><img src="img/denied.png" class="fragment roll-in"/></p>
        </section>
        
        <section>
          <section id="csrf">
            <h2>8. Cross-Site Request Forgery (CSRF)</h2>
            <blockquote>« Une attaque CSRF (Cross Site Request Forgery) force le navigateur d'une victime authentifiée à envoyer une requête HTTP forgée, comprenant le cookie de session de la victime ainsi que toute autre information automatiquement inclue, à une application web vulnérable.
»</blockquote>
            <p><img src="img/csrf.png" class="fragment roll-in"/></p>
          </section>
            
          <section>
            <h2>Exemple d'attaque</h2>
            <pre>URL d'envoi d'email massif :<code class="url">http://www.example.net/admin/massive_send.php?title=Code+Promo&body=Bonjour+PRENOM,[...]</code></pre>
            <pre>Dans une page non-liée, hébergée par le pirate :<code class="html"><img src="http://www.example.net/admin/massive_send.php?title=Buy+Viagra&body=MWAHAHA"/></code></pre>
            <p><strong>Effet</strong> : Un utilisateur, ayant des droits suffisants, accédant par inadvertance à cette page verra l'action malicieuse déclenchée en son nom sur le site web vulnérable.</p>
            <p class="fragment"><span style="color:red;">P</span><span style="color:lightblue;">W</span><span style="color:yellow;">N</span><span style="color:green;">D</span><span style="color:pink;">!</span></p>
          </section>
          
          <section>
            <h2>Défenses possibles</h2>
            <ol>
              <li>Utiliser un token d'utilisation unique dans un champ caché des formulaires (Anti-CSRF token)</li>
              <li>Demander à l'utilisateur de confirmer son action (saisir son mot de passe, CAPTCHA, etc.)</li>
            </ol>
            <br/><br/>
            <p><strong>Attention :</strong></p>
            <ul>
              <li>Il est nécessaire, mais non suffisant, d'utiliser une méthode HTTP appropriée (POST et non GET) pour les actions sensibles</li>
              <li>Cette attaque est fréquemment combinée à une attaque XSS du même site ou d'un site tiers</li>
              <li>La vérification de l'entête HTTP Referer n'est pas suffisante</li>
              <li>Attention également au Click-Jacking ! (utiliser X-Frame-Options)</li>
            </ul>
          </section>
        </section>
        
        <section>
          <h2>9. Utilisation de composants avec des vulnérabilités connues</h2>
          <blockquote>« Les composants vulnérables, tels que bibliothèques, contextes et autres modules logiciels fonctionnent presque toujours avec des privilèges maximum. Ainsi, si exploités, ils peuvent causer des pertes de données sérieuses ou une prise de contrôle du serveur. »</blockquote>
          <p><img src="img/sysadmin.png" class="fragment roll-in"/></p>
        </section>
        
        <section>
          <section id="redirection">
            <h2>10. Redirections et renvois non validés</h2>
            <blockquote>« Les applications web redirigent fréquemment les utilisateurs vers d'autres pages et sites internet, et utilisent des données non fiables pour déterminer les pages de destination. Sans validation appropriée, les attaquants peuvent réorienter les victimes vers des sites de phishing ou de malware. »</blockquote>
            <p><img src="img/redirect.jpg" class="fragment roll-in"/></p>
          </section>
          
          <section>
            <h2>Exemple d'attaque</h2>
            <pre>Code de redirection :<code class="php">header('Location: '.$_GET['url']);</code></pre>
            <pre>URL envoyé à un utilisateur innocent :<code class="url">http://www.example.com/redirect.php?url=http://www.example-phishing.com</code></pre>
            <p><strong>Effet</strong> : L'image de marque du site (son URL) est détournée afin de gagner la confiance de l'utilisateur.</p>
            <p class="fragment"><span style="color:red;">P</span><span style="color:lightblue;">W</span><span style="color:yellow;">N</span><span style="color:green;">D</span><span style="color:pink;">!</span></p>
          </section>
          
          <section>
            <h2>Comment bloquer l'attaque</h2>
            <ol>
              <li>Ne pas inclure l'URL de redirection dans les paramètres GET ou POST</li>
              <li>Préférer une valeur abstraite (<code>url=24</code>) qui ne pourra pas être détournée</li>
              <li>Si c'est nécessaire de le faire, toujours vérifier la validité de l'URL avant de l'envoyer à l'utilisateur</li>
            </ol>
          </section>
        </section>

        <section id="bonus">
          <h2>En bonus</h2>
          <ul>
            <li>Ne jamais se baser uniquement sur la <em>sécurité par l'obscurité</em></li>
            <li>Faire auditer son code / son application par un pair</li>
            <li>Garder à l'esprit que ce n'est pas toujours le code qui est en cause</li>
            <li><strong>Hackez !</strong></li>
          </ul>
        </section>
                
        <section>
          <h1>THE END</h1>
          <h3>Par Alexandre Gravel-Raymond</h3>
          <p><img src="img/unicorn.jpg" class="fragment roll-in"/></p>
        </section>
        
        <section>Slide 2</section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,
        previewLinks: true,
        mouseWheel: true,
        width: "80%",

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'node_modules/reveal.js-menu/menu.js' }
        ]
      });
      
      Reveal.addEventListener( 'fragmentshown', function (event) {
      	if (event.fragment.id == "quebec") {
          alert('Vive le Québec Libre !');
        }
      });
    </script>
  </body>
</html>
